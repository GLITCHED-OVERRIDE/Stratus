<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stratus Launcher</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
body { margin:0; font-family: Arial; background:#000; color:#fff; padding:70px 20px 20px 20px; }
.item { background:#111; padding:15px; margin:15px auto; width:85%; cursor:pointer; border:1px solid #fff; border-radius:10px; text-align:center; }
</style>
</head>
<body>

<h1>Stratus Launcher</h1>
<div id="apps"></div>

<script>
const JSON_URL = "https://raw.githubusercontent.com/GLITCHED-OVERRIDE/Stratus/refs/heads/main/Apps.json";

async function loadApps() {
    const res = await fetch(JSON_URL);
    const apps = await res.json();
    const container = document.getElementById("apps");

    apps.forEach(app=>{
        const div = document.createElement("div");
        div.className = "item";
        div.textContent = app.name;
        div.addEventListener("click",()=>launchApp(app));
        container.appendChild(div);
    });
}

loadApps();

async function launchApp(app){
    const res = await fetch(app.url);
    const blob = await res.blob();
    const zip = await JSZip.loadAsync(blob);

    // Map filenames to blob URLs
    const blobMap = {};
    for(const filename of Object.keys(zip.files)){
        const fileBlob = await zip.files[filename].async("blob");
        blobMap[filename] = URL.createObjectURL(fileBlob);
    }

    // Rewrite index.html to point all assets to blob URLs
    let indexName = Object.keys(zip.files).find(f=>f.toLowerCase().endsWith("index.html"));
    if(!indexName){
        alert("No index.html in ZIP");
        return;
    }
    let indexContent = await zip.files[indexName].async("string");

    // Replace all file references in HTML with blob URLs
    Object.keys(blobMap).forEach(f=>{
        const escapedName = f.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); // escape regex
        const regex = new RegExp(escapedName,"g");
        indexContent = indexContent.replace(regex, blobMap[f]);
    });

    // Create new Blob URL for rewritten HTML
    const indexBlob = new Blob([indexContent], {type:'text/html'});
    const indexURL = URL.createObjectURL(indexBlob);

    // Open in new window
    const win = window.open(indexURL, "_blank");
}
</script>

</body>
</html>
